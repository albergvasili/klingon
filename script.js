//import dictionary from './dictionary.js';
let dictionary = {
  loD: {
    klingon: "loD",
    type: "noun",
    language: true,
    english: "man",
    level: 1,
    imagine: "a MAN carries a heavy LOAD of equipment on his back.",
  },
  be_: {
    klingon: "be'",
    type: "noun",
    language: true,
    english: "woman",
    level: 1,
    imagine: "a WOMAN chases a ferocious BEAR with a stick.",
  },
  jup: {
    klingon: "jup",
    type: "noun",
    language: true,
    english: "friend",
    level: 1,
    imagine: "your best FRIEND goes on a trip to JUPiter.",
  },
  jagh: {
    klingon: "jagh",
    type: "noun",
    language: true,
    english: "enemy",
    level: 1,
    imagine: "you captured your ENEMY in a large glass JAR.",
  },
  puq: {
    klingon: "puq",
    type: "noun",
    language: true,
    english: "child",
    level: 1,
    imagine: "a small CHILD is PUKing non-stop.",
  },
  Saj: {
    klingon: "Saj",
    type: "noun",
    language: false,
    english: "pet",
    level: 1,
    imagine: "in a PET shop, you have never seen SUCH terrifying animals.",
  },
  HoD: {
    klingon: "HoD",
    type: "noun",
    language: true,
    english: "captain",
    level: 1,
    imagine: "two enemy guards HOLD your CAPTAIN (the Head of Department) by the arms.",
  },
  yaS: {
    klingon: "yaS",
    type: "noun",
    language: true,
    english: "officer",
    level: 1,
    imagine: "two enemy guards turn your OFFICER into a pile of ASH.",
  },
  nov: {
    klingon: "nov",
    type: "noun",
    language: true,
    english: "alien",
    level: 1,
    imagine: "aLIENS try to escape a star system that has suddendly gone NOVA.",
  },
  yiH: {
    klingon: "yiH",
    type: "noun",
    language: false,
    english: "tribble",
    level: 1,
    imagine: "a klingon shouts YEEEK when he finds himself sharing a bed with dozens of TRIBBLES.",
  },
  Qel: {
    klingon: "Qel",
    type: "noun",
    language: true,
    english: "doctor",
    level: 1,
    imagine: "your DOCTOR could not CARE Less about your health.",
  },
  SID: {
    klingon: "SID",
    type: "noun",
    language: true,
    english: "patient",
    level: 1,
    imagine: "a PATIENT refuses to let the nurse change the SHEETs.",
  },
  qorDu_: {
    klingon: "qorDu'",
    type: "noun",
    language: true,
    english: "family",
    level: 1,
    imagine: "you tie your FAMILY together with a CORD TO stop them from hitting each other with sticks.",
  },
  ghu: {
    klingon: "ghu",
    type: "noun",
    language: true,
    english: "baby",
    level: 1,
    imagine: "a kangoROO holds your BABY in his pouch.",
  },
  tlhIngan: {
    klingon: "tlhIngan",
    type: "noun",
    language: true,
    english: "klingon",
    level: 1,
    imagine: "the correct spelling of the word 'KLINGON'",
  },
  human: {
    klingon: "Human",
    type: "noun",
    language: true,
    english: "human",
    level: 1,
    imagine: "a human is a human.",
  },
  jaH: {
    klingon: "jaH",
    type: "verb",
    transitive: false,
    english: ["goes", "go"],
    level: 1,
    imagine: "JACK GOES up the Hill.",
  },
  ghoS: {
    klingon: "ghoS",
    type: "verb",
    transitive: false,
    english: ["comes", "come"],
    level: 1,
    imagine: "lots of people COME towards you in a RUSH.",
  },
  Sop: {
    klingon: "Sop",
    type: "verb",
    transitive: true,
    english: ["eats", "eat"],
    level: 1,
    imagine: "you EAT everything in the SHOP. CHOP CHOP!",
  },
  tlhutlh: {
    klingon: "tlhutlh",
    type: "verb",
    transitive: true,
    english: ["drinks", "drink"],
    level: 1,
    imagine: "a musician DRINKS wine using THE LUTE as a cup.",
  },
  jatlh: {
    klingon: "jathl",
    type: "verb",
    transitive: false,
    english: ["speaks", "speak"],
    level: 1,
    imagine: "a SPEAKING CHART WILL always tell you where to go.",
  },
  yaj: {
    klingon: "yaj",
    type: "verb",
    transitive: true,
    english: ["understands", "understand"],
    level: 1,
    imagine: "no one UNDERSTANDS the inscription written on the ARCH.",
  },
  laD: {
    klingon: "laD",
    type: "verb",
    transitive: true,
    english: ["reads", "read"],
    level: 1,
    imagine: "you READ a large book on how to make LARD.",
  },
  ghItlh: {
    klingon: "ghItlh",
    type: "verb",
    transitive: true,
    english: ["writes", "write"],
    level: 1,
    imagine: "you WRITE a RIDDLE to describe how to find your buried treasure.",
  },
  suffix_be_: {
    klingon: "-be'",
    type: "verb suffix",
    english: "not",
    level: 1,
    imagine: "this is NOT 'woman'... It's a suffix.",
  },
  _ej: {
    klingon: "'ej",
    type: "conjunction",
    english: "and",
    level: 1,
    imagine: "you are hanging over the EDGE of a cliff, AND ytry to reach a stick to climb back up.",
  },
  _ach: {
    klingon: "'ach",
    type: "conjunction",
    english: "and",
    level: 1,
    imagine: "the front door is locked, BUT you use a stick to open the HATCH.",
  },
  legh: {
    klingon: "legh",
    type: "verb",
    transitive: true,
    english: ["sees", "see"],
    level: 2,
    imagine: "you SEE the LAIR of a dangerous animal in the distance.",
  },
  Qoy: {
    klingon: "Qoy",
    type: "verb",
    transitive: true,
    english: ["hears", "hear"],
    level: 2,
    imagine: "the Queen puts her head into the pond in order to HEAR the KOI fish.",
  },
  ghaj: {
    klingon: "ghaj",
    type: "verb",
    transitive: true,
    english: ["has", "have"],
    level: 2,
    imagine: "a klingon HAS several RANCHes in texas.",
  },
  neH: {
    klingon: "neH",
    type: "verb",
    transitive: true,
    english: ["wants", "want"],
    level: 2,
    imagine: "a thirsty vampire WANTS to find a nice, juicy NECK.",
  },
  QaH: {
    klingon: "QaH",
    type: "verb",
    transitive: true,
    english: ["helps", "help"],
    level: 2,
    imagine: "the Queen HELPS some hunters to cut up a CARcass of a dead animal.",
  },
  lob: {
    klingon: "lob",
    type: "verb",
    transitive: true,
    english: ["obeys", "obey"],
    level: 2,
    imagine: "a businessman who will obey anyone who massageshis earLOBE.",
  },
  ghoj: {
    klingon: "ghoj",
    type: "verb",
    transitive: false,
    english: ["learns", "learn"],
    level: 2,
    imagine: "a classroom full of ROACHes LEARNING klingon.",
  },
  ghojmoH: {
    klingon: "ghojmoH",
    type: "verb",
    transitive: true,
    english: ["teaches", "teach"],
    level: 2,
    imagine: "a classroom where the ROACHes MOCK their TEACHer.",
  },
  tera_: {
    klingon: "tera'",
    type: "noun",
    language: false,
    english: "earth",
    level: 2,
    imagine: "Orbis tertius...",
  },
  vulqan: {
    klingon: "vulqan",
    type: "noun",
    language: false,
    english: "vulcan",
    level: 2,
    imagine: "another planet.",
  },
  romuluS: {
    klingon: "romuluS",
    type: "noun",
    language: false,
    english: "romulus",
    level: 2,
    imagine: "this is not the founder of rome.",
  },
  qarDaS: {
    klingon: "qarDaS",
    type: "noun",
    language: false,
    english: "cardassia",
    level: 2,
    imagine: "not a species of armenian stone-carvers.",
  },
  Har: {
    klingon: "Har",
    type: "verb",
    transitive: false,
    english: ["believes", "believe"],
    level: 2,
    imagine: "you now BELIEVE that the milky way is made of long white HAIRs",
  },
  Hon: {
    klingon: "Hon",
    type: "verb",
    transitive: false,
    english: ["doubts", "doubt"],
    level: 2,
    imagine: "you DOUBT that this 300 year old HONey is still edible.",
  },
  vIt: {
    klingon: "vIt",
    type: "verb",
    transitive: false,
    english: ["tells the truth", "tell the truth"],
    level: 2,
    imagine: "your FEET always TELL THE TRUTH",
  },
  nep: {
    klingon: "nep",
    type: "verb",
    transitive: false,
    english: ["lies", "lie"],
    level: 2,
    imagine: "your enemy promises you a trip to NEPtune... it's a LIE.",
  },
  yIt: {
    klingon: "yIt",
    type: "verb",
    transitive: false,
    english: ["walks", "walk"],
    level: 2,
    imagine: "you must WALK another hundred miles before YOU EAT.",
  },
  qet: {
    klingon: "qet",
    type: "verb",
    transitive: false,
    english: ["runs", "run"],
    level: 2,
    imagine: "you ask KATE out on a date - she RUNS away as fast as she can.",
  },
  jaw: {
    klingon: "jaw",
    type: "verb",
    transitive: false,
    english: ["chats", "chat"],
    level: 2,
    imagine: "two JOUsting knights stop halfway through a contest to have a nice chat.",
  },
  lop: {
    klingon: "lop",
    type: "verb",
    transitive: false,
    english: ["celebrates", "celebrate"],
    level: 2,
    imagine: "an old woman ELOPES from the psychiatric institution and CELEBRATES her victory over the nurses.",
  },
  suffix_pu_: {
    klingon: "pu'",
    type: "noun suffix",
    english: "plural",
    level: 2,
    imagine: "it's not one, but many...",
  },
  Hov: {
    klingon: "Hov",
    type: "noun",
    language: false,
    english: "sun",
    level: 3,
    imagine: "a STAR orbited by a million of horse HOOVES.",
  },
  yuQ: {
    klingon: "yuQ",
    type: "noun",
    language: false,
    english: "planet",
    level: 3,
    imagine: "a PLANET whose residents are being entertained by the Queen on her UKULELE.",
  },
  maS: {
    klingon: "maS",
    type: "noun",
    language: false,
    english: "moon",
    level: 3,
    imagine: "the earth's MOON is covered in MARSHland",
  },
  Duj: {
    klingon: "Duj",
    type: "noun",
    language: false,
    english: "ship",
    level: 3,
    imagine: "a SHIP crewed by DUTCH people: The Flying Dutchman.",
  },
  Hoqra_: {
    klingon: "Hoqra'",
    type: "noun",
    language: false,
    english: "tricorder",
    level: 3,
    imagine: "you use your TRICORDER to analyse an antique HOCKEY stick that is incredibly RARE.",
  },
  nuH: {
    klingon: "nuH",
    type: "noun",
    language: false,
    english: "weapon",
    level: 3,
    imagine: "a NUKE is the only WEAPON you need.",
  },
  thlob: {
    klingon: "thlob",
    type: "verb",
    transitive: true,
    english: ["asks", "ask"],
    level: 3,
    imagine: "a man ASKS THE LOBE before making an important business decision.",
  },
  jang: {
    klingon: "jang",
    type: "verb",
    transitive: false,
    english: ["answers", "answer"],
    level: 3,
    imagine: "if someone wants to know if you are rich, you ANSWER by JANGLING the loose coins in your pocket.",
  },
  lo_: {
    klingon: "lo'",
    type: "verb",
    transitive: true,
    english: ["uses", "use"],
    level: 3,
    imagine: "someone who USES the LAW to punish his enemies, rather than using a stick.",
  },
  ngeH: {
    klingon: "ngeH",
    type: "verb",
    transitive: true,
    english: ["sends", "send"],
    level: 3,
    imagine: "you SEND some card AND EGGS to your best friend.",
  },
  Hev: {
    klingon: "Hev",
    type: "verb",
    transitive: true,
    english: ["receives", "receive"],
    level: 3,
    imagine: "you have RECEIVED inspiration from the HEAVens.",
  },
  je_: {
    klingon: "je'",
    type: "verb",
    transitive: true,
    english: ["buys", "buy"],
    level: 3,
    imagine: "you BUY a charming CHAIR made entirely from sticks and twigs.",
  },
  ngev: {
    klingon: "ngev",
    type: "verb",
    transitive: true,
    english: ["sells", "sell"],
    level: 3,
    imagine: "you SELL something AND GIVE all the money to your friends.",
  },
  moj: {
    klingon: "moj",
    type: "verb",
    transitive: true,
    english: ["becomes", "become"],
    level: 3,
    imagine: "your company BECOMES bigger and bigger by MERging with all its rivals one by one.",
  },
  vav: {
    klingon: "vav",
    type: "noun",
    language: true,
    english: "father",
    level: 3,
    imagine: "you have five fathers.",
  },
  SoS: {
    klingon: "SoS",
    type: "noun",
    language: true,
    english: "mother",
    level: 3,
    imagine: "your MOTHER SHOSHanna is telling you to be quiet - Shhh!.",
  },
  joH: {
    klingon: "joH",
    type: "noun",
    language: true,
    english: "lord/lady",
    level: 3,
    imagine: "the Lord and the Lady of the house go for an early morning JOG around their vast estate.",
  },
  jIl: {
    klingon: "jIl",
    type: "noun",
    language: true,
    english: "neighbour",
    level: 3,
    imagine: "all your NEIGHBOURS are called JILL.",
  },
  qama_: {
    klingon: "qama'",
    type: "noun",
    language: true,
    english: "prisoner",
    level: 3,
    imagine: "you become a PRISONER in a cage made of sticks because you have very bad KARMA.",
  },
};

let quiz = document.getElementById("quiz");
let chooseLesson = document.getElementById("choose-lesson");
let chooseLangDiv = document.getElementById("choose-language");
let selection = document.getElementById("selection");
let select = document.getElementById("select");
let dictByLevel;
let dictAccumulated;

selection.addEventListener("change", () => start());

function start() {
  let h2 = document.createElement("h2");
  select.setAttribute("disabled", "");
  quiz.removeChild(quiz.lastChild);
  h2.textContent = `Welcome to lesson ${selection.value} !`;
  quiz.append(h2);
  chooseLangDiv.removeChild(chooseLangDiv.lastChild);
  selectLevel(selection.value);
  chooseLanguage();
};

function selectLevel(level) {
  dictByLevel = {};
  for (let word in dictionary) {
    if (dictionary[word].level == level) {
      dictByLevel = { ...dictByLevel, [word]: dictionary[word]};
    }
  }
  for (let word in dictionary) {
    if (dictionary[word].level <= level) {
      dictAccumulated = { ...dictAccumulated, [word]: dictionary[word]};
    }
  }
};

function newElement(element, classe="", extraAttribute=false, type=false) {
  let newElement = document.createElement(element);
  newElement.setAttribute("class", classe);
  if (extraAttribute) {
    newElement.setAttribute(extraAttribute[0], extraAttribute[1]);
  }
  if (type) {
    newElement.setAttribute("type", type);
  }
  return newElement;
};

/* TODO: finish refactoring chooseLanguage()
function selectQuiz(buttonValue, questionGeneratorFunction) {
  let languageButton = newElement("input", "", ["value", buttonValue], "button");
  languageButton.addEventListener("click", () => {
    quiz.removeChild(quiz.lastChild);
    return questionGeneratorFunction;
  });
};
*/

function chooseLanguage() {
  let choose = document.getElementById("choose-language");
  let div = newElement("div");
  let vocabularyLesson = newElement("input", "", ["value", "Vocabulary"], "button");
  let englishKlingon = newElement("input", "", ["value", "Eng-Kli words"], "button");
  let klingonEnglish = newElement("input", "", ["value", "Kli-Eng words"], "button");
  let englishKlingonSentence = newElement("input", "", ["value", "Eng-Kli sentences"], "button");
  let klingonEnglishSentence = newElement("input", "", ["value", "Kli-Eng sentences"], "button");

  div.setAttribute("id", "choose-lang");

  vocabularyLesson.addEventListener("click", () => {
    quiz.removeChild(quiz.lastChild);
    vocabularyGenerator();
  });

  englishKlingon.addEventListener("click", () => {
    quiz.removeChild(quiz.lastChild);
    wordGenerator("english", "klingon", true)
  });

  englishKlingonSentence.addEventListener("click", () => {
    quiz.removeChild(quiz.lastChild);
    sentenceGenerator("english", "klingon");
  });

  klingonEnglish.addEventListener("click", () => {
    quiz.removeChild(quiz.lastChild);
    wordGenerator("klingon", "english")
  });

  klingonEnglishSentence.addEventListener("click", () => {
    quiz.removeChild(quiz.lastChild);
    sentenceGenerator("klingon", "english");
  });

  div.append(vocabularyLesson, englishKlingon, klingonEnglish, englishKlingonSentence, klingonEnglishSentence);

  choose.append(div);
};

function questions(translate, answer, hintMessage="", toLang, showHint=false) {
  let questionContainer = newElement("div", "questionContainer");
  let formContainer = newElement("div", "formContainer");
  let label = document.createElement("label");
  let input = newElement("input", "", ["size", 10], "text");
  let button = newElement("input", "", ["value", "submit"], "submit");
  let result = newElement("div", "result", ["style", "display: none"]);

  label.textContent = `${translate} :`;

  button.addEventListener("click", () => {
    checkAnswer(input, answer, result, toLang);
  });

  if (showHint) {
    result.textContent = `Try again: ${hintMessage}`;
  } else {
    result.textContent = `Try again`;
  }

  formContainer.append(label, input, button);
  questionContainer.append(formContainer, result);

  return questionContainer;
};

function vocabularyGenerator() {
  let vocabulary = newElement("div");
  for (let word in dictByLevel) {

    let wordObject = dictByLevel[word];
    let div = newElement("div");
    let h3 = newElement("h3");
    let p = newElement("p");

    if (wordObject.type === "verb"){
      h3.textContent = `${wordObject.klingon} -> ${wordObject.english[0]}`;
    } else {
      h3.textContent = `${wordObject.klingon} -> ${wordObject.english}`;
    }
    p.textContent = `Imagine: ${wordObject.imagine}`;
    div.append(h3, p);

    vocabulary.append(div);
  }
  quiz.append(vocabulary);
};

function checkAnswer(input, answer, result, toLang) {
  let inputValue;
  if (toLang === "english") {
    inputValue = input.value.trim().toLowerCase();
    answer = answer.toLowerCase();
  } else {
    inputValue = input.value.trim();
  }

  if (inputValue === answer) {
    result.removeAttribute("style");
    result.textContent = "Correct !";
    input.setAttribute("readonly", "readonly");
  } else {
    result.removeAttribute("style");
  }
};

function randomWord(selectDictionary, exceptions=[]) {
  let dictionaryKeys = Object.keys(selectDictionary).filter(word => !exceptions.includes(word));;

  return dictionaryKeys[Math.floor(Math.random()*dictionaryKeys.length)];
};

function wordGenerator(fromLang, toLang, hint) {
  let vocabulary = newElement("div");
  let wordsUsed = [];

  for (let i = 0; i < 15; i++){
    let word = randomWord(dictByLevel, wordsUsed);
    wordsUsed = [...wordsUsed, word];

    if (dictByLevel[word].type === "verb" && fromLang === "english") {
      vocabulary
        .append(questions(dictByLevel[word][fromLang][0], dictByLevel[word][toLang], `Imagine ${dictByLevel[word].imagine}`, toLang, hint));
    } else if (dictByLevel[word].type === "verb" && toLang === "english") {
      vocabulary
        .append(questions(dictByLevel[word][fromLang], dictByLevel[word][toLang][0], `Imagine ${dictByLevel[word].imagine}`, toLang, hint));
    } else {
      vocabulary
        .append(questions(dictByLevel[word][fromLang], dictByLevel[word][toLang], `Imagine ${dictByLevel[word].imagine}`, toLang, hint));
    }
  }

  quiz.append(vocabulary);
};

function sentenceGenerator(fromLang, toLang) {
  let verbDict;
  let nounDict;
  for (let word in dictAccumulated) {
    if (dictAccumulated[word].type === "verb") {
      verbDict = { ...verbDict, [word]: dictAccumulated[word] };
    } else if (dictAccumulated[word].type === "noun") {
      nounDict = { ...nounDict, [word]: dictAccumulated[word] };
    }
  }

  // let numberOfNouns = () => Math.floor(Math.random()*2);

  let sentences = newElement("div");

  for (let i = 0; i < 10; i++){
    let verb = randomWord(verbDict);
    let noun = randomWord(nounDict);
    let phrase = {
      klingon: `${verbDict[verb].klingon} ${nounDict[noun].klingon}`,
      english: `The ${nounDict[noun].english} ${verbDict[verb].english[0]}`
    };

    sentences.append(questions(phrase[fromLang], phrase[toLang], "", toLang));
  }

  quiz.append(sentences);
};
